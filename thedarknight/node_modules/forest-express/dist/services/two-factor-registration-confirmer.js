"use strict";

var P = require('bluebird');

var request = require('superagent');

var ServiceUrlGetter = require('./service-url-getter');

var logger = require('./logger');

function TwoFactorRegistrationConfirmer(_ref) {
  var projectId = _ref.projectId,
      envSecret = _ref.envSecret,
      useGoogleAuthentication = _ref.useGoogleAuthentication,
      email = _ref.email,
      forestToken = _ref.forestToken;

  this.perform = function () {
    return new P(function (resolve, reject) {
      var forestUrl = new ServiceUrlGetter().perform();
      var bodyData = {
        useGoogleAuthentication: useGoogleAuthentication
      };

      if (useGoogleAuthentication) {
        bodyData.forestToken = forestToken;
      } else {
        bodyData.email = email;
      }

      request.post("".concat(forestUrl, "/liana/v2/projects/").concat(projectId, "/two-factor-registration-confirm")).send(bodyData).set('forest-secret-key', envSecret).end(function (error) {
        if (error) {
          logger.error('Two factor registration confirmation error: ', error);
          return reject(new Error());
        }

        return resolve();
      });
    });
  };
}

module.exports = TwoFactorRegistrationConfirmer;